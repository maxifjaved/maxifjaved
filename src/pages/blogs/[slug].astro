---
import MainLayout from "../../layouts/MainLayout.astro";
import ArticleHeader from "../../components/ArticleHeader.astro";
import ArticleContent from "../../components/ArticleContent.astro";
import SocialShare from "../../components/SocialShare.astro";
import AuthorInfo from "../../components/AuthorInfo.astro";
import RelatedPosts from "../../components/RelatedPosts.astro";
import { getCollection } from 'astro:content';
import type { CollectionEntry } from 'astro:content';

export async function getStaticPaths() {
  const blogPosts = await getCollection('blog');
  return blogPosts.map((post) => ({
    params: { slug: post.slug },
    props: { post },
  }));
}

type Props = {
  post: CollectionEntry<'blog'>;
};

const { post } = Astro.props;
const { Content } = await post.render();
const {
  title: blogTitle,
  subtitle,
  author,
  date,
  category,
  readTime,
  featuredImage,
  relatedPosts,
  description: metaDescription,
  tags,
} = post.data;
const title = blogTitle;
const description = metaDescription || subtitle;

const currentUrl = new URL(Astro.url).toString();
const canonicalUrl = `https://maxifjaved.com/blogs/${post.slug}`;

// Generate JSON-LD structured data
const jsonLdScript = JSON.stringify({
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": title,
  "description": description,
  "image": `https://maxifjaved.com${featuredImage}`,
  "author": {
    "@type": "Person",
    "name": author.name
  },
  "publisher": {
    "@type": "Organization",
    "name": "Muhammad Asif Javed",
    "logo": {
      "@type": "ImageObject",
      "url": "https://maxifjaved.com/img/logo.png"
    }
  },
  "datePublished": new Date(date).toISOString(),
  "dateModified": new Date(date).toISOString(),
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": canonicalUrl
  }
});
---

<MainLayout
  title={title}
  description={description}
  ogImage={`https://maxifjaved.com${featuredImage}`}
  canonicalUrl={canonicalUrl}
>
  {jsonLdScript && (
    <script type="application/ld+json" set:html={jsonLdScript} />
  )}
  <ArticleHeader
    title={blogTitle}
    subtitle={subtitle}
    category={category}
    date={date}
    author={author}
    readTime={readTime}
    featuredImage={featuredImage}
  />
  <Content />
  <SocialShare title={blogTitle} url={currentUrl} />
  <AuthorInfo author={author} />
  <RelatedPosts relatedPosts={relatedPosts || []} />
</MainLayout>